<!doctype html><html lang="fr"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><title>Habitu.be ‚Äî Prototype (ultra-l√©ger)</title>
<style>
:root{--bg:#f7f3ea;--card:#fffdf8;--text:#1e1f1a;--green:#2a7a57;--border:#c6beae;--r:4px;--gap:8px;--fs:13px}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font:400 var(--fs)/1.35 system-ui,-apple-system,Roboto,sans-serif;color:var(--text);background:var(--bg)}
#app{max-width:480px;margin:0 auto;min-height:100%;display:flex;flex-direction:column;position:relative}
.heat{position:fixed;left:0;right:0;bottom:0;height:0;background:linear-gradient(0deg,#8ec5a8,transparent);opacity:.35;pointer-events:none;z-index:0}
button,.select,.tab,.stab,.btn,.btnToggle,.navbtn,.calBtn,.backMini{font:600 13px/1.2 system-ui,-apple-system,Roboto,sans-serif;padding:6px 10px;border-radius:var(--r);cursor:pointer;border:1px solid var(--border);background:var(--card)}
.btn.primary{background:var(--green);color:#fff;border-color:transparent}.btn.danger{border-color:#d99;color:#600;background:#fff5f5}
.btnToggle.active,.tab.active,.stab.active{outline:2px solid var(--green)}.select{appearance:none}
.top{position:sticky;top:0;background:var(--bg);z-index:6;border-bottom:1px solid var(--border);padding:6px var(--gap);display:flex;align-items:center;gap:8px}
.brand{font-weight:800;cursor:pointer;display:flex;align-items:center;gap:6px}.brand .logo{font-size:18px}.spacer{flex:1}
.daysWrap{position:sticky;top:44px;background:var(--bg);z-index:5;border-bottom:1px solid var(--border);padding:6px var(--gap);display:flex;align-items:center;gap:6px;justify-content:space-between}
.rightBtns{display:flex;flex-direction:row;gap:6px;align-items:flex-end}
.dateLabel,.todayCount{font-weight:700;padding:0;border:none;background:transparent}
.list{padding:var(--gap);display:grid;grid-template-columns:1fr;gap:var(--gap);position:relative;z-index:1}
.card{border:1px solid var(--border);background:var(--bg);border-radius:var(--r);display:grid;grid-template-columns:1fr 64px;overflow:hidden}
.card.done{border:2px solid var(--green)}
.content{padding:4px;display:flex;flex-direction:column;gap:4px}
.title{font-weight:700;display:flex;align-items:center;gap:4px;font-size:13px;min-height:22px}.title .hint{color:#5b5b56;font-weight:500}
.desc{font-size:12px;color:#5b5b56;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;cursor:pointer}
.desc.open{-webkit-line-clamp:unset;display:block;white-space:pre-line;overflow:visible}
.friends{margin-top:auto;display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.badge{display:flex;align-items:center;gap:6px;padding:4px 6px;border:1px solid var(--border);border-radius:var(--r);background:#fff;font-size:11px;line-height:1.2;cursor:pointer}
.levelCol{padding:0 6px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.levelBtn{width:100%;height:60px;border-radius:var(--r);border:1px solid var(--border);background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;user-select:none;line-height:1.05;position:relative}
.levelBtn .big{position:absolute;top:4px;left:0;right:0;text-align:center;font-size:22px;font-weight:800}
.levelBtn .scoreText{position:absolute;bottom:2px;left:4px;right:4px;text-align:center;font-size:16px;font-weight:800;line-height:1}
.section{padding:var(--gap)}
.detailHead{display:flex;align-items:center;gap:8px;position:sticky;top:0;z-index:5;background:var(--bg);padding:6px var(--gap);border-bottom:1px solid var(--border)}
.detailTitle{font-weight:800;font-size:16px}
.tabs{display:flex;gap:6px;padding:var(--gap);border-bottom:1px solid var(--border);background:var(--bg);position:sticky;top:80px;z-index:4}
.tab{flex:1;text-align:center}.view{display:none}.view.active{display:block}
.rankHeader{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px}
.rank{display:grid;gap:8px;margin-top:8px}
.row{display:flex;justify-content:space-between;align-items:center;padding:6px;border:1px solid var(--border);background:var(--bg);border-radius:var(--r)}
.leftRank{display:flex;align-items:center;gap:8px}
.scoreEmoji{font-size:26px;font-weight:900;margin-left:4px;white-space:pre-line}
.likeBtn{min-width:74px;text-align:center}
.calendarWrap{padding:0 var(--gap) var(--gap)}
.calTop{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:8px}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.cell{height:55px;display:grid;place-items:center;border:1px dashed var(--border);background:var(--card);border-radius:var(--r);position:relative;overflow:hidden;cursor:pointer}
.dayNum{position:absolute;top:4px;right:6px;font-size:10px;color:#777}
.seedMark{position:absolute;top:18px;left:0;right:0;text-align:center;font-size:14px;line-height:1;font-weight:700}
.cell .dur{position:absolute;bottom:2px;left:4px;right:4px;text-align:center;font:800 12px/1 system-ui}
.modal{position:fixed;inset:0;display:none;background:rgba(0,0,0,.2);padding:0;z-index:10}
.modal.on{display:flex;align-items:stretch;justify-content:stretch}
.sheet{position:absolute;inset:0;background:var(--card)}
.sheetHeader{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px var(--gap);border-bottom:1px solid var(--border);background:var(--bg)}
.sheetBody{padding:var(--gap);height:calc(100% - 50px);overflow:auto;background:var(--bg)}
.grid{display:grid;gap:8px}
.opt{border:1px solid var(--border);background:var(--card);border-radius:var(--r);padding:12px;display:flex;gap:8px;align-items:center;cursor:pointer}
.opt .emoji{font-size:20px}
.field{display:grid;gap:4px}
input[type="text"],textarea{padding:10px;border:1px solid var(--border);border-radius:var(--r);background:#fffdf8;font-size:13px}
textarea.readonly{background:#f7f3ea;border:1px dashed var(--border);pointer-events:auto}
textarea.editing{background:#fff;border:1px solid var(--border)}
.stabs{display:flex;gap:6px;padding:6px;position:sticky;top:52px;background:var(--bg);border-bottom:1px solid var(--border);z-index:2}
.stab{flex:1;text-align:center}
.sview{display:none}.sview.active{display:block}
.rowInline{display:flex;gap:8px;align-items:center}.rowInline input{flex:1}.rowInline .btn.copyOnly{padding:6px 10px}
.miniInfo{font-size:12px;color:#555}
.hide{display:none}
</style></head><body>
<div class="heat" id="heat"></div>
<div id="app">
  <div class="top">
    <div class="brand" id="brand"><span class="logo">üå±</span>Habitu.be</div>
    <div class="spacer"></div>
    <select id="spaceSel" class="select" title="Changer d‚Äôespace"></select>
    <button class="navbtn" id="openSpace" title="Espace">‚ìò</button>
  </div>

  <div class="daysWrap" id="daysWrap">
    <button class="navbtn" id="prevDay">‚Üê</button>
    <div style="display:flex;align-items:center;gap:6px">
      <div class="dateLabel" id="dateLabel">‚Äî</div>
      <div class="todayCount" id="todayCount">0h00</div>
    </div>
    <div class="rightBtns">
      <button class="navbtn" id="nextDay">‚Üí</button>
      <button class="navbtn" id="addBtn" title="Ajouter">Ôºã</button>
    </div>
  </div>

  <main id="home" class="view active"><div class="list" id="cards"></div></main>

  <section id="detail" class="view">
    <div class="detailHead">
      <button class="backMini" id="backHome">‚Üê</button>
      <div class="detailTitle" id="detailTitle"></div>
    </div>
    <div class="tabs">
      <button class="tab active" data-tab="members">üë• Participants</button>
      <button class="tab" data-tab="info">‚ÑπÔ∏è Infos</button>
      <button class="tab" data-tab="history">üìÖ Historique</button>
      <button class="tab" data-tab="settings">‚öôÔ∏è R√©glages</button>
    </div>
    <div class="section">
      <div class="view active" id="tab-members">
        <div class="rankHeader">
          <b>Classement</b>
          <div style="font-size:12px;display:flex;gap:8px;align-items:center">
            P√©riode:
            <div style="display:flex;gap:8px">
              <button class="btnToggle" data-period="7" id="btnP7">7 jours</button>
              <button class="btnToggle active" data-period="30" id="btnP30">30 jours</button>
              <button class="btnToggle" data-period="all" id="btnPAll">Total</button>
            </div>
          </div>
        </div>
        <div class="rank" id="rank"></div>
      </div>
      <div class="view" id="tab-info">
        <div class="grid">
          <div class="field">
            <label><b>Description</b></label>
            <textarea id="habitDesc" class="readonly" readonly placeholder="D√©cris ton habitude (objectif, contexte, tips). Clique pour √©diter."></textarea>
          </div>
        </div>
      </div>
      <div class="view" id="tab-history">
        <div class="calendarWrap">
          <div class="calTop">
            <div style="display:flex;gap:6px;align-items:center">
              <button class="calBtn" id="prevMonth">‚Üê</button>
              <div id="monthLabel" style="font-weight:700"></div>
              <button class="calBtn" id="nextMonth">‚Üí</button>
            </div>
            <div id="calWhoWrap" style="display:flex;gap:6px;align-items:center">
              <span style="font-size:12px">Voir :</span>
              <select id="calWho" class="select" style="padding:6px"></select>
            </div>
          </div>
          <div class="calendar" id="cal"></div>
        </div>
      </div>
      <div class="view" id="tab-settings">
        <div class="grid">
          <div class="field">
            <label><b>R√©gularit√©</b></label>
            <select id="freqSelect" class="select">
              <option value="1">Quotidien</option><option value="2">Tous les 2 jours</option>
              <option value="3">Tous les 3 jours</option><option value="4">Tous les 4 jours</option>
              <option value="5">Tous les 5 jours</option><option value="6">Tous les 6 jours</option>
              <option value="7">Hebdomadaire</option>
            </select>
          </div>
          <div class="field"><label><b>Dur√©e par d√©faut</b></label><select id="mockDefaultDur" class="select"><option>15 min</option><option>30 min</option><option>45 min</option><option>60 min</option></select></div>
          <div class="field"><label><b>Rappel (mock)</b></label><select class="select"><option>Aucun</option><option>9:00</option><option>12:30</option><option>20:00</option></select></div>
        </div>
      </div>
    </div>
  </section>

  <section id="space" class="view">
    <div class="detailHead">
      <button class="backMini" id="backFromSpace">‚Üê</button>
      <div class="detailTitle" id="spaceHeaderTitle"></div>
    </div>
    <div class="tabs">
      <button class="tab active" data-stab="sprofile">üë• Participants</button>
      <button class="tab" data-stab="sinfo">‚ÑπÔ∏è Infos</button>
      <button class="tab" data-stab="shistory">üìÖ Historique</button>
      <button class="tab" data-stab="sparams">‚öôÔ∏è R√©glages</button>
    </div>
    <div class="section">
      <div class="view active" id="sprofile">
        <div class="rankHeader"><b>Classement (toutes habitudes)</b></div>
        <div class="miniInfo">D√©mo : likes proportionnels aux heures.</div>
        <div class="rank" id="spaceRank"></div>
      </div>
      <div class="view" id="sinfo">
        <div class="grid">
          <div class="field">
            <label><b>Description</b></label>
            <textarea id="spaceDescInfo" class="readonly" readonly placeholder="Pr√©sentez l‚Äôespace, les r√®gles et l‚Äô√©tat d‚Äôesprit. Cliquez pour √©diter."></textarea>
          </div>
        </div>
      </div>
      <div class="view" id="shistory">
        <div class="calendarWrap">
          <div class="calTop">
            <div style="display:flex;gap:6px;align-items:center">
              <button class="calBtn" id="sPrevMonth">‚Üê</button>
              <div id="sMonthLabel" style="font-weight:700"></div>
              <button class="calBtn" id="sNextMonth">‚Üí</button>
            </div>
            <div style="display:flex;gap:6px;align-items:center">
              <span style="font-size:12px">Voir :</span>
              <select id="sCalWho" class="select" style="padding:6px"></select>
            </div>
          </div>
          <div class="calendar" id="sCal"></div>
        </div>
      </div>
      <div class="view" id="sparams">
        <div class="grid">
          <div class="field"><label><b>Nom de l'espace</b></label><input id="paramSpaceLabel" type="text"/></div>
          <div class="field"><label><b>Mon pseudo</b></label><input id="paramName" type="text" value="Moi"/></div>
          <div class="field"><label><b>Visibilit√©</b></label><select class="select"><option>Priv√©</option><option>Sur invitation</option></select></div>
          <div class="field"><label><b>Fuseau horaire</b></label><select class="select"><option>Paris (UTC+1)</option><option>UTC</option></select></div>
          <div style="margin-top:12px"><button class="btn danger" id="quitSpaceBtn">Quitter</button></div>
        </div>
      </div>
    </div>
  </section>

  <div class="modal" id="modalAdd">
    <div class="sheet">
      <div class="sheetHeader"><div id="modalTitle">Ajouter</div><button class="closeX" id="closeAdd">‚®â</button></div>
      <div class="sheetBody">
        <div class="grid">
          <div class="opt" id="addHabit"><div class="emoji">üå±</div><div><b>Nouvelle habitude</b><div class="subtitle">Rejoindre un d√©fi</div></div></div>
          <div class="opt" id="inviteFriend"><div class="emoji">üåû</div><div><b>Inviter un membre</b><div class="subtitle">Lien √† partager</div></div></div>
          <div class="opt" id="joinSpace"><div class="emoji">ü§ù</div><div><b>Rejoindre un espace</b><div class="subtitle">Entrer un code</div></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalInvite">
    <div class="sheet">
      <div class="sheetHeader"><div>Inviter</div><button class="closeX" id="closeInvite">‚®â</button></div>
      <div class="sheetBody">
        <div class="grid">
          <div class="field">
            <label><b>Lien √† partager</b></label>
            <div class="rowInline"><input id="inviteLink" type="text" readonly/><button class="btn copyOnly" id="copyInvite" title="Copier">üîó</button></div>
            <div class="subtitle">Le lien contient le code de ton espace.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalHabit">
    <div class="sheet">
      <div class="sheetHeader"><div id="habitTitle">Nouvelle habitude</div><button class="closeX" id="closeHabit">‚®â</button></div>
      <div class="sheetBody"><div class="grid" id="step1"></div><div class="grid" id="step2" style="display:none"></div></div>
    </div>
  </div>

  <div class="modal" id="modalSpace">
    <div class="sheet">
      <div class="sheetHeader"><div>Cr√©er / Rejoindre un espace</div><button class="closeX" id="closeSpace">‚®â</button></div>
      <div class="sheetBody">
        <div class="grid">
          <div class="field"><label><b>Code (6 caract√®res alphanum√©riques)</b></label>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="spaceCode" type="text" placeholder="ABC123" maxlength="6" style="text-transform:uppercase"/>
              <button class="btn" id="spaceGen">Cr√©er</button>
            </div>
          </div>
          <div class="field"><label><b>Ton pr√©nom</b></label><input id="spaceName" type="text" placeholder="Pr√©nom"/></div>
          <div class="grid" style="grid-template-columns:1fr 1fr"><button class="btn" id="spaceCancel">Annuler</button><button class="btn primary" id="spaceSave">Rejoindre</button></div>
          <div class="subtitle">Prototype : entre le code & ton pr√©nom, puis choisis le type de profil.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalWizard">
    <div class="sheet">
      <div class="sheetHeader"><div id="wizTitle">Type de profil</div><button class="closeX" id="closeWizard">‚®â</button></div>
      <div class="sheetBody"><div class="grid" id="wizStep"></div></div>
    </div>
  </div>
</div>

<script>
const CATS=[{id:'sante',emoji:'ü©∫',nom:'Sant√©'},{id:'relations',emoji:'ü§ù',nom:'Relations'},{id:'esprit',emoji:'üß†',nom:'Esprit'},{id:'corps',emoji:'üí™',nom:'Corps'},{id:'vie',emoji:'üß∫',nom:'Vie'},{id:'loisirs',emoji:'üé®',nom:'Loisirs'},{id:'repos',emoji:'üòå',nom:'Repos'}];
const CHALLENGES=[{type:'private',id:'screenoff',cat:'sante',emoji:'üõå',titre:'Sans √©cran avant le coucher',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'private',id:'repas',cat:'sante',emoji:'ü•ó',titre:'Repas sain fait maison',amis:['Ben','Duc']},{type:'private',id:'lire',cat:'esprit',emoji:'üìñ',titre:'Lire un livre ou un roman',amis:['Chlo√©']},{type:'private',id:'etire',cat:'corps',emoji:'ü§∏',titre:'√âtirements corporels',amis:['Anna','Nicolas']},{type:'private',id:'ranger',cat:'vie',emoji:'üßΩ',titre:'Rangement ou m√©nage',amis:['Chlo√©']},{type:'private',id:'creer',cat:'loisirs',emoji:'üé∏',titre:'Cr√©er ou jouer',amis:['Ben','Pauline']},{type:'private',id:'respirer',cat:'repos',emoji:'üå¨Ô∏è',titre:'Respiration coh√©rence cardiaque',amis:['Anna','Marie']}];
const GROUP_CHALLENGES=[{type:'group',id:'silence_matin',cat:'coloc',emoji:'ü§´',titre:'Silence matinal',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'poubelles',cat:'coloc',emoji:'üóëÔ∏è',titre:'Descendre les poubelles',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'cuisine',cat:'coloc',emoji:'üßΩ',titre:'Nettoyer la cuisine',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'communs',cat:'coloc',emoji:'üß∫',titre:'Ranger les communs',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'apero_coloc',cat:'coloc',emoji:'üçù',titre:'Repas partag√©',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'energie',cat:'coloc',emoji:'‚ö°',titre:'√âconomie d‚Äô√©nergie',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'wc_sdb',cat:'coloc',emoji:'üöΩ',titre:'Nettoyer WC & SDB',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']},{type:'group',id:'silence_nuit',cat:'coloc',emoji:'üåô',titre:'Silence nocturne',amis:['Anna','Ben','Chlo√©','Nicolas','Marie']}];
const ASSOCIATION_CHALLENGES=[{type:'group',id:'accueil_benevoles',cat:'asso',emoji:'ü§ù',titre:'Accueil des b√©n√©voles',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'com_reseaux',cat:'asso',emoji:'üì£',titre:'Com r√©seaux mise √† jour',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'planning_evenements',cat:'asso',emoji:'üóìÔ∏è',titre:'Planning √©v√©nements √† jour',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'collecte_fonds',cat:'asso',emoji:'üí∂',titre:'Collecte de fonds trait√©e',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'stock_materiel',cat:'asso',emoji:'üì¶',titre:'Stock mat√©riel v√©rifi√©',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'compte_rendu',cat:'asso',emoji:'üìù',titre:'Compte rendu publi√©',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'partenariats',cat:'asso',emoji:'ü§ù',titre:'Partenariats contact√©s',amis:['Alice','Bruno','Camille','Dina']},{type:'group',id:'formation',cat:'asso',emoji:'üéì',titre:'Formation interne r√©alis√©e',amis:['Alice','Bruno','Camille','Dina']}];
const FAMILY_CHALLENGES=[{type:'group',id:'planning_semaine',cat:'famille',emoji:'üìÖ',titre:'Planning familial mis √† jour',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'courses_pretes',cat:'famille',emoji:'üõí',titre:'Liste de courses faite ensemble',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'linge_pli√©',cat:'famille',emoji:'üëï',titre:'Linge lav√©, pli√©, rang√©',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'repas_prevu',cat:'famille',emoji:'üç≤',titre:'Menus de la semaine planifi√©s',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'rdv_prepares',cat:'famille',emoji:'üìã',titre:'Rendez-vous & trajets anticip√©s',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'chambres_rangees',cat:'famille',emoji:'üß∫',titre:'Pi√®ces communes et chambres rang√©es',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'tri_recyclage',cat:'famille',emoji:'‚ôªÔ∏è',titre:'Tri s√©lectif & poubelles sorties',amis:['Maman','Papa','David','Jonas']},{type:'group',id:'check_dimanche',cat:'famille',emoji:'üïí',titre:'Pr√©paration de la semaine le dimanche',amis:['Maman','Papa','David','Jonas']}];
const CLASS_CHALLENGES=[{type:'group',id:'materiel_commun',cat:'classe',emoji:'üì¶',titre:'Mat√©riel collectif en ordre',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'tableaux_prop',cat:'classe',emoji:'üßΩ',titre:'Tableau nettoy√© en fin de cours',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'affiches',cat:'classe',emoji:'üìú',titre:'Affichage clair et √† jour',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'projets_planifies',cat:'classe',emoji:'üóÇÔ∏è',titre:'Projets ou expos√©s planifi√©s',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'materiel_partage',cat:'classe',emoji:'‚úèÔ∏è',titre:'Outils partag√©s bien rang√©s',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'retard_groupe',cat:'classe',emoji:'‚è∞',titre:'Tous √† l‚Äôheure au d√©but du cours',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'bilan_vendredi',cat:'classe',emoji:'üìä',titre:'Bilan collectif du vendredi fait',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']},{type:'group',id:'gestion_roles',cat:'classe',emoji:'ü™ë',titre:'R√¥les (pr√©sident, secr√©taire...) r√©partis',amis:['M. Dupont','Emma','Lucas','Lucie','Yanis','Clara']}];
const OFFICE_CHALLENGES=[{type:'group',id:'planning_equipe',cat:'bureau',emoji:'üìÖ',titre:'Planning d‚Äô√©quipe synchronis√©',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'reunion_prete',cat:'bureau',emoji:'üóìÔ∏è',titre:'R√©union pr√©par√©e & document√©e',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'projets_suivis',cat:'bureau',emoji:'üìã',titre:'Suivi des projets mis √† jour',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'stock_rang√©',cat:'bureau',emoji:'üì¶',titre:'Mat√©riel ou fournitures en ordre',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'postes_propres',cat:'bureau',emoji:'üßΩ',titre:'Bureaux et espace commun rang√©s',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'checkin_lundi',cat:'bureau',emoji:'üß≠',titre:'Check-in collectif du lundi',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'docs_partages',cat:'bureau',emoji:'üíæ',titre:'Docs communs organis√©s et nomm√©s',amis:['Alice','Bob','Carla','Dan']},{type:'group',id:'cloture_vendredi',cat:'bureau',emoji:'üïî',titre:'Cl√¥ture de la semaine en √©quipe',amis:['Alice','Bob','Carla','Dan']}];

const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function fmtDate(d){const M=['01','02','03','04','05','06','07','08','09','10','11','12'][d.getMonth()];const j=String(d.getDate()).padStart(2,'0');const J=['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'][d.getDay()];return `${J} ${j}/${M}`;}
function genCode(){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let s='';for(let i=0;i<6;i++)s+=c[Math.floor(Math.random()*c.length)];return s;}
const round15=m=>Math.round(m/15)*15;function rint(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function pickQuarterUpTo75(){return 15*rint(1,5)}
function lvlEmoji(v){if(v<=7)return'üå∞';if(v<=14)return'üå±';if(v<=21)return'üçÄ';if(v<=28)return'üåº';if(v<=35)return'üåª';if(v<=42)return'üå∑';if(v<=49)return'üåπ';if(v<=56)return'ü™ª';if(v<=64)return'üíê';return'üéã';}
function names(xs,m=3){if(xs.length<=m)return xs.join(', ');const s=xs.slice(0,m).join(', ');return `${s}‚Ä¶ et ${xs.length-m} autres`;}
function m2txt(m){const h=Math.floor(m/60),mn=m%60;return `${h}h${String(mn).padStart(2,'0')}`;}
function m2txtShort(m){if(!m)return'-';const h=(m/60)|0, mn=m%60;return h?`${h}h${String(mn).padStart(2,'0')}`:`${mn}m`;}
const GENERIC_TIPS=["Commence petit et r√©gulier.","Pr√©pare ton mat√©riel √† l‚Äôavance.","Bloque un cr√©neau fixe au calendrier.","Annonce ton objectif √† un ami.","Trace tes progr√®s chaque jour.","C√©l√®bre chaque micro-victoire.","R√©duis la friction: rends l‚Äôaction √©vidente.","Associe l‚Äôhabitude √† un d√©clencheur simple.","Fais-le m√™me 2 minutes les jours difficiles.","Rends l‚Äôenvironnement compatible.","Supprime une distraction √©vidente.","Cr√©e une check-list de 3 √©tapes.","Plan B si tu rates ton horaire.","Ferme la boucle: fais un petit bilan.","Pr√©pare une version ‚Äòvoyage‚Äô minimaliste.","Utilise un rappel doux (alarme ou post-it).","Vis au rythme: respire avant de commencer.","Visualise le r√©sultat attendu.","Ralentis pour √™tre pr√©cis, puis acc√©l√®re.","Note une difficult√© & une solution.","Partage un retour d‚Äôexp√©rience avec un pair.","Automatise ce qui peut l‚Äô√™tre.","Range imm√©diatement apr√®s l‚Äôaction.","R√©compense-toi sans culpabilit√©.","Passe en mode avion 20 minutes."];
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function buildDesc(){return shuffle([...GENERIC_TIPS]).slice(0,7).join('\n')}
function oneLiner(s){return (s||'').replace(/\s*\n\s*/g,' ¬∑ ')}
let period='30', spaceId='D0PWE3', userName='Moi', dayOff=0;
const SPACES={'D0PWE3':{emoji:'üë§',label:'üë§ Individu',type:'private',ch:CHALLENGES,desc:'Espace personnel.'},'E8D3FS':{emoji:'üè†',label:'üè† Colocation',type:'group',ch:GROUP_CHALLENGES,desc:'Espace partag√© √† la maison.'},'AS50CI':{emoji:'üèõÔ∏è',label:'üèõÔ∏è Association',type:'group',ch:ASSOCIATION_CHALLENGES,desc:'Rituels d‚Äô√©quipe pour une asso.'},'WS32D7':{emoji:'‚ù§Ô∏è',label:'‚ù§Ô∏è Famille',type:'group',ch:FAMILY_CHALLENGES,desc:'Routines familiales au quotidien.'},'SR3S0D':{emoji:'üè´',label:'üè´ Classe',type:'group',ch:CLASS_CHALLENGES,desc:'Vie de classe et rituels p√©dagogiques.'},'PD03XZ':{emoji:'üè¢',label:'üè¢ Bureau',type:'group',ch:OFFICE_CHALLENGES,desc:'Rituels simples pour mieux travailler.'}};
const HABIT_DESC={}, SPACE_DESC_TXT={};
const claps={};(()=>{const all=[...CHALLENGES,...GROUP_CHALLENGES,...FAMILY_CHALLENGES,...CLASS_CHALLENGES,...OFFICE_CHALLENGES,...ASSOCIATION_CHALLENGES];all.forEach(c=>{claps[c.id]={};[...new Set([...c.amis,'Moi'])].forEach(n=>claps[c.id][n]=Math.floor(Math.random()*101));});})();
const FREQ={};function defaultFreqFor(h){return h.type==='group'?(Math.random()<0.6?1:2):(Math.random()<0.4?1:rint(2,5))}
;[...CHALLENGES,...GROUP_CHALLENGES,...FAMILY_CHALLENGES,...CLASS_CHALLENGES,...OFFICE_CHALLENGES,...ASSOCIATION_CHALLENGES].forEach(h=>{FREQ[h.id]=FREQ[h.id]||defaultFreqFor(h)});
const BASE_MINUTES={}, HISTORY_MIN={}, STATE_TODAY={};
function ensureHabit(hid){if(!BASE_MINUTES[hid]) BASE_MINUTES[hid]=pickQuarterUpTo75(); if(!HISTORY_MIN[hid]) HISTORY_MIN[hid]={}; if(!HABIT_DESC[hid]) HABIT_DESC[hid]=buildDesc();}
function parseSeedNames(text){return text.replace(/^üå±\s*/,'').split(',').map(s=>s.trim()).filter(Boolean)}
function setSeedBadge(namesEl, arr){if(!arr.length){namesEl.parentElement?.remove();return}namesEl.textContent=`üå± ${names(arr,3)}`}
function daySerial(d){return Math.floor(d.getTime()/86400000)}
function curDate(){const t=new Date();t.setHours(0,0,0,0);t.setDate(t.getDate()+dayOff);return t;}
function randDay(hid,serial){let h=0;const s=hid+':'+serial;for(let i=0;i<s.length;i++)h=(h*31+s.charCodeAt(i))>>>0;return (h%100)/100}
function isVisibleToday(hid,d){const serial=daySerial(d);const f=FREQ[hid]||1;const due=(serial%f)===0;const hidden=(randDay(hid,serial)<0.25);return due && !hidden}
function getSpace(){return SPACES[spaceId]||SPACES['D0PWE3'];}
function listChallenges(){return getSpace().ch;}
function findAny(id){return [...CHALLENGES,...GROUP_CHALLENGES,...FAMILY_CHALLENGES,...CLASS_CHALLENGES,...OFFICE_CHALLENGES,...ASSOCIATION_CHALLENGES].find(c=>c.id===id);}
function sumTodayMinutes(){return $$('#cards .levelBtn').map(b=>{const st=+b.dataset.state||0, base=+b.dataset.baseMin||0;return st===1?base:st===2?(base*2):0}).reduce((a,b)=>a+b,0)}
function renderDateBar(){$("#dateLabel").textContent=fmtDate(curDate());$("#todayCount").textContent=m2txt(round15(sumTodayMinutes()));}
let activeId=null, refBtn=null;
function drawBtn(btn){const p=+btn.dataset.plants||0, s=+btn.dataset.suns||0, tot=p+s;const state=+btn.dataset.state||0, base=+btn.dataset.baseMin||0;const val=state===0?'-':m2txtShort(round15(state===1?base:base*2));btn.innerHTML=`<div class="big">${lvlEmoji(tot)}</div><div class="scoreText">${val}</div>`;}
function collapseAllDescs(){$$('.desc.open').forEach(d=>{d.classList.remove('open');d.textContent=d.dataset.short||''})}
document.addEventListener('click',e=>{if(!e.target.closest('.desc')) collapseAllDescs()},{capture:true})
function setupDescToggle(desc,hid){desc.dataset.full=HABIT_DESC[hid]||'';desc.dataset.short=oneLiner(desc.dataset.full);desc.textContent=desc.dataset.short;desc.onclick=(ev)=>{ev.stopPropagation();const open=desc.classList.toggle('open');desc.textContent=open?(desc.dataset.full||''):desc.dataset.short}}
function renderCards(){
  const root=$("#cards");root.innerHTML='';const d=curDate();
  listChallenges().forEach(it=>{
    if(!isVisibleToday(it.id,d)) return; ensureHabit(it.id);
    const card=document.createElement('article');card.className='card';
    const cont=document.createElement('div');cont.className='content';
    const title=document.createElement('div');title.className='title';title.innerHTML=`<span style="font-size:24px">${it.emoji}</span><span class="base">${it.titre}</span><span class="hint" id="h-${it.id}"></span>`;
    const desc=document.createElement('div');desc.className='desc';setupDescToggle(desc,it.id);
    const friends=document.createElement('div');friends.className='friends';
    if(Math.random()<.5){const n=rint(1,2);const seed=[...it.amis].sort(()=>Math.random()-.5).slice(0,n);const b=document.createElement('div');b.className='badge seed-badge';b.textContent=`üå± ${names(seed)}`;friends.appendChild(b)}
    if(Math.random()<.7){const n=rint(2,5),sun=[...it.amis].sort(()=>Math.random()-.5).slice(0,n);const b=document.createElement('div');b.className='badge sun-badge';b.textContent=`üåû ${names(sun)}`;friends.appendChild(b)}
    friends.addEventListener('click',(e)=>{const badge=e.target.closest('.badge');if(badge){openDetail(it.id,btn);}})
    cont.append(title,desc,friends);
    const col=document.createElement('div');col.className='levelCol';
    const btn=document.createElement('button');btn.className='levelBtn';btn.dataset.cid=it.id;
    const basePlants=Math.floor(Math.random()*65), suns=claps[it.id]?.['Moi']??0;
    btn.dataset.basePlants=String(basePlants);btn.dataset.plants=String(basePlants);btn.dataset.suns=String(suns);
    btn.dataset.baseMin=String(BASE_MINUTES[it.id]);btn.dataset.state='0';drawBtn(btn);
    const cycle=()=>{const st=+btn.dataset.state||0;const next=st===0?1:st===1?2:0;btn.dataset.state=String(next);
      if(next!==0){card.classList.add('done');
        let sb=friends.querySelector('.seed-badge');if(!sb){sb=document.createElement('div');sb.className='badge seed-badge';friends.prepend(sb)}
        let current=sb.textContent?parseSeedNames(sb.textContent):[];if(!current.includes('Moi')) current=['Moi',...current];setSeedBadge(sb,current);
      }else{card.classList.remove('done');const sb=friends.querySelector('.seed-badge');if(sb){let current=parseSeedNames(sb.textContent);current=current.filter(x=>x!=='Moi');setSeedBadge(sb,current);}}
      drawBtn(btn);renderDateBar();
    };
    col.onclick=cycle;
    col.append(btn);card.append(cont,col);root.appendChild(card);
  });
  renderDateBar();
}
let calOff=0;
function minfo(off=0){const b=new Date();b.setDate(1);b.setMonth(b.getMonth()+off);const y=b.getFullYear(),m=b.getMonth();return{y,m,fd:(new Date(y,m,1).getDay()+6)%7,days:new Date(y,m+1,0).getDate()}}
function populateCalWho(){const sel=$("#calWho");sel.innerHTML='';sel.add(new Option('Tous','__all__'));sel.add(new Option('Moi','Moi'));(findAny(activeId)?.amis||[]).forEach(n=>sel.add(new Option(n,n)));sel.value='__all__';}
function renderCalendar(){
  const wrap=$("#cal");wrap.innerHTML='';const {y,m,fd,days}=minfo(calOff);const months=['Jan','F√©v','Mar','Avr','Mai','Juin','Juil','Ao√ª','Sep','Oct','Nov','D√©c'];let monthMinutes=0;
  for(let i=0;i<fd;i++){const c=document.createElement('div');c.className='cell';c.style.opacity=.35;wrap.appendChild(c)}
  const today=new Date(),sameMonth=(calOff===0);
  for(let d=1;d<=days;d++){
    const c=document.createElement('div');c.className='cell';
    const dn=document.createElement('div');dn.className='dayNum';dn.textContent=String(d);c.appendChild(dn);
    if(Math.random()<0.6){
      const min=pickQuarterUpTo75();
      const mark=document.createElement('div');mark.className='seedMark';mark.textContent='üå±';c.appendChild(mark);
      const dur=document.createElement('div');dur.className='dur';dur.textContent=m2txtShort(min);c.appendChild(dur);
      monthMinutes+=min;
    }
    if(sameMonth&&d===today.getDate()){c.style.outline=`2px solid ${getComputedStyle(document.documentElement).getPropertyValue('--green')}`}
    c.onclick=()=>{const b=new Date();b.setDate(1);b.setMonth(b.getMonth()+calOff);const tgt=new Date(b.getFullYear(),b.getMonth(),d),now=new Date();now.setHours(0,0,0,0);dayOff=Math.round((tgt-now)/86400000);showHome();renderCards();renderDateBar();window.scrollTo({top:0,behavior:'smooth'})};
    wrap.appendChild(c);
  }
  $("#monthLabel").textContent=`${months[m]} ${y}  üå±${m2txt(round15(monthMinutes))}`;
}
$("#prevMonth").onclick=()=>{calOff--;renderCalendar()};$("#nextMonth").onclick=()=>{calOff++;renderCalendar()};$("#calWho")?.addEventListener('change',renderCalendar);

function openDetail(id,btnRef){
  activeId=id;refBtn=btnRef;hideAll();$("#detail").classList.add('active');$("#daysWrap").classList.add('hide');
  $$('.tab').forEach(t=>t.classList.remove('active'));document.querySelector('[data-tab="members"]').classList.add('active');
  $$('#detail .view').forEach(v=>v.classList.remove('active'));$('#tab-members').classList.add('active');
  const it=findAny(id);$("#detailTitle").textContent=`${it.emoji} ${it.titre}`;
  const t=$("#habitDesc");t.value=HABIT_DESC[id]||'';setupEditableTextarea(t,val=>{HABIT_DESC[id]=val;});
  renderRank();populateCalWho();renderCalendar();renderHabitSettings();
}
function showHome(){hideAll();$("#home").classList.add('active');$("#daysWrap").classList.remove('hide')}
function hideAll(){$$('#home,#detail,#space').forEach(v=>v.classList.remove('active'))}
$("#backHome").onclick=showHome;
function demoHM(rangeDays){const min=round15(rint(30,25*60));return {min, txt:m2txt(min)}}
function likeFactorFromMin(min){return 0.5+(min/60)/25}
function makeLikeBtn(base){const b=document.createElement('button');b.className='btn likeBtn';b.textContent=`üåû ${base}`;b.dataset.base=String(base);b.dataset.liked='0';b.onclick=()=>{const liked=b.dataset.liked==='1';b.dataset.liked=liked?'0':'1';b.textContent=`üåû ${liked?b.dataset.base:(+b.dataset.base+1)}`;b.style.outline=liked?'none':'2px solid var(--green)'};return b}
function renderRank(){
  const it=findAny(activeId);const days=period==='7'?7:period==='30'?30:120;
  const rows=[...it.amis.map(n=>({n,me:false})),{n:userName||'Moi',me:true}].map(x=>{const v=demoHM(days);const baseLikes=Math.max(0,Math.round(v.min/60*likeFactorFromMin(v.min)));return {...x,totalMin:v.min,txt:v.txt,likes:baseLikes};}).sort((a,b)=>b.totalMin-a.totalMin);
  const root=$("#rank");root.innerHTML='';rows.forEach(({n,totalMin,txt,me,likes})=>{const row=document.createElement('div');row.className='row';const left=document.createElement('div');left.className='leftRank';const big=document.createElement('span');big.className='scoreEmoji';big.textContent=`${lvlEmoji(Math.min(65,Math.round(totalMin/60)))} ${txt}`;const name=document.createElement('b');name.textContent=`${n}${me?' (toi)':''}`;left.append(big,name);const like=makeLikeBtn(likes);row.append(left,like);root.appendChild(row);});
}
function updPeriodBtns(){$$('#btnP7,#btnP30,#btnPAll').forEach(b=>b.classList.toggle('active',b.dataset.period===period))}
$('#btnP7').onclick=()=>{period='7';updPeriodBtns();renderRank()};$('#btnP30').onclick=()=>{period='30';updPeriodBtns();renderRank()};$('#btnPAll').onclick=()=>{period='all';updPeriodBtns();renderRank()};
function renderHabitSettings(){const sel=$("#freqSelect");if(!activeId||!sel)return;sel.value=String(FREQ[activeId]||1);sel.onchange=()=>{FREQ[activeId]=parseInt(sel.value||'1',10)}}
function openSpacePage(){hideAll();$("#space").classList.add('active');$("#daysWrap").classList.add('hide');updSpaceHeader();renderSpaceRank();setupSpaceInfo();populateSpaceWho();renderSpaceCalendar();}
function updSpaceHeader(){const sp=getSpace();$("#spaceHeaderTitle").textContent=sp.label;$("#paramSpaceLabel").value=sp.label;$("#paramName").value=userName||'Moi'}
function setupSpaceInfo(){const sp=getSpace();const t=$("#spaceDescInfo");t.value=SPACE_DESC_TXT[spaceId]??(sp.desc||'');setupEditableTextarea(t,val=>{SPACE_DESC_TXT[spaceId]=val;sp.desc=val})}
function allMembersOfSpace(){const ch=listChallenges();const set=new Set(['Moi']);ch.forEach(c=>c.amis.forEach(a=>set.add(a)));return Array.from(set)}
function renderSpaceRank(){
  const root=$("#spaceRank");root.innerHTML='';
  const rows=allMembersOfSpace().map(n=>{const min=round15(rint(30,25*60));const txt=m2txt(min);const baseLikes=Math.max(0,Math.round(min/60*likeFactorFromMin(min)));return {n,txt,min,me:(n===userName||n==='Moi'),likes:baseLikes};}).sort((a,b)=>b.min-a.min);
  rows.forEach(({n,txt,min,me,likes})=>{const row=document.createElement('div');row.className='row';const left=document.createElement('div');left.className='leftRank';const big=document.createElement('span');big.className='scoreEmoji';big.textContent=`${lvlEmoji(Math.min(65,Math.round(min/60)))} ${txt}`;const name=document.createElement('b');name.textContent=`${n}${me?' (toi)':''}`;left.append(big,name);const like=makeLikeBtn(likes);row.append(left,like);root.appendChild(row);});
}
let sCalOff=0;
function populateSpaceWho(){const sel=$("#sCalWho");sel.innerHTML='';sel.add(new Option('Tous','__all__'));allMembersOfSpace().forEach(n=>sel.add(new Option(n,n)));sel.value='__all__';}
function renderSpaceCalendar(){
  const wrap=$("#sCal");wrap.innerHTML='';const {y,m,fd,days}=minfo(sCalOff);const months=['Jan','F√©v','Mar','Avr','Mai','Juin','Juil','Ao√ª','Sep','Oct','Nov','D√©c'];let monthMinutes=0;
  for(let i=0;i<fd;i++){const c=document.createElement('div');c.className='cell';c.style.opacity=.35;wrap.appendChild(c)}
  for(let d=1;d<=days;d++){
    const c=document.createElement('div');c.className='cell';const dn=document.createElement('div');dn.className='dayNum';dn.textContent=String(d);c.appendChild(dn);
    if(Math.random()<0.65){const mins=pickQuarterUpTo75();const mark=document.createElement('div');mark.className='seedMark';mark.textContent='üå±';c.appendChild(mark);const dur=document.createElement('div');dur.className='dur';dur.textContent=m2txtShort(mins);c.appendChild(dur);monthMinutes+=mins;}
    wrap.appendChild(c);
  }
  $("#sMonthLabel").textContent=`${months[m]} ${y}  üå±${m2txt(round15(monthMinutes))}`;
}
$("#sPrevMonth").onclick=()=>{sCalOff--;renderSpaceCalendar()};$("#sNextMonth").onclick=()=>{sCalOff++;renderSpaceCalendar()};$("#sCalWho").addEventListener('change',renderSpaceCalendar);
function setupEditableTextarea(el,onSave){
  el.classList.add('readonly');el.readOnly=true;
  el.onclick=()=>{if(el.readOnly){el.readOnly=false;el.classList.remove('readonly');el.classList.add('editing');el.focus();el.setSelectionRange(el.value.length,el.value.length)}};
  el.addEventListener('blur',()=>{el.readOnly=true;el.classList.remove('editing');el.classList.add('readonly');onSave(el.value)});
}
function updSel(){const sel=$("#spaceSel");sel.innerHTML='';const order=['E8D3FS','AS50CI','D0PWE3','WS32D7','SR3S0D','PD03XZ'];order.forEach(id=>{if(SPACES[id]){const o=document.createElement('option');o.value=id;o.textContent=SPACES[id].label;sel.appendChild(o)}});Object.keys(SPACES).forEach(id=>{if(!order.includes(id)){const o=document.createElement('option');o.value=id;o.textContent=SPACES[id].label;sel.appendChild(o)}});sel.value=spaceId;}
const selSpace=$("#spaceSel");selSpace.addEventListener('change',()=>{spaceId=selSpace.value;renderCards();showHome();});
$("#openSpace").onclick=openSpacePage;$("#backFromSpace").onclick=showHome;
const mAdd=$("#modalAdd"),mHabit=$("#modalHabit"),mInvite=$("#modalInvite"),mSpace=$("#modalSpace"),mWizard=$("#modalWizard");
const open=m=>m.classList.add('on'), close=m=>m.classList.remove('on');
$("#addBtn").onclick=()=>open(mAdd);$("#closeAdd").onclick=()=>close(mAdd);
$("#addHabit").onclick=()=>{close(mAdd);open(mHabit);step1()};$("#inviteFriend").onclick=()=>{close(mAdd);openInvite()};$("#joinSpace").onclick=()=>{close(mAdd);open(mSpace)};
function openInvite(){const code=spaceId;$("#inviteLink").value=`https://habitu.be/?code=${code}`;open(mInvite)}
$("#closeInvite").onclick=()=>close(mInvite);$("#copyInvite").onclick=async()=>{try{await navigator.clipboard.writeText($("#inviteLink").value);alert("Lien copi√© !")}catch(e){alert("Copie impossible")}}
$("#spaceGen").onclick=()=>{$("#spaceCode").value=genCode()};$("#spaceCancel").onclick=()=>close(mSpace);$("#closeSpace").onclick=()=>close(mSpace);
$("#spaceSave").onclick=()=>{const code=($("#spaceCode").value||'').toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,6), name=($("#spaceName").value||'').trim()||'Moi'; if(!code){alert("Entre un code d‚Äôespace.");return} if(SPACES[code]){spaceId=code;userName=name;updSel();renderCards();close(mSpace)} else{close(mSpace);launchWizard(code,name)}};
let wiz={code:'',name:'',type:'private',profile:'Autre'};
function launchWizard(code,name){wiz={code,name,type:'private',profile:'Autre'};open(mWizard);wizProfileStep()}
function wizProfileStep(){const root=$("#wizStep");$("#wizTitle").textContent="Type de profil";root.innerHTML='';[{emoji:'üë§',label:'Individu',apply:()=>({emoji:'üë§',label:'üë§ Individu',type:'private',ch:CHALLENGES,desc:'Espace personnel.'})},{emoji:'üè†',label:'Colocation',apply:()=>({emoji:'üè†',label:'üè† Colocation',type:'group',ch:GROUP_CHALLENGES,desc:'Espace partag√© √† la maison.'})},{emoji:'üèõÔ∏è',label:'Association',apply:()=>({emoji:'üèõÔ∏è',label:'üèõÔ∏è Association',type:'group',ch:ASSOCIATION_CHALLENGES,desc:'Rituels d‚Äô√©quipe pour une asso.'})},{emoji:'‚ù§Ô∏è',label:'Famille',apply:()=>({emoji:'‚ù§Ô∏è',label:'‚ù§Ô∏è Famille',type:'group',ch:FAMILY_CHALLENGES,desc:'Routines familiales au quotidien.'})},{emoji:'üè´',label:'Classe',apply:()=>({emoji:'üè´',label:'üè´ Classe',type:'group',ch:CLASS_CHALLENGES,desc:'Vie de classe.'})},{emoji:'üè¢',label:'Bureau',apply:()=>({emoji:'üè¢',label:'üè¢ Bureau',type:'group',ch:OFFICE_CHALLENGES,desc:'Rituels simples pour mieux travailler.'})},{emoji:'‚ú®',label:'Autre',apply:()=>({emoji:'‚ú®',label:'‚ú® Autre',type:'group',ch:GROUP_CHALLENGES,desc:'Espace partag√©.'})}].forEach(o=>{const el=document.createElement('div');el.className='opt';el.innerHTML=`<div class="emoji">${o.emoji}</div><div><b>${o.label}</b></div>`;el.onclick=()=>{const d=o.apply();SPACES[wiz.code]=d;spaceId=wiz.code;userName=wiz.name;updSel();close(mWizard);renderCards();};root.appendChild(el);});}
$("#closeWizard").onclick=()=>close(mWizard);
$("#quitSpaceBtn").onclick=()=>{const sp=getSpace();if(confirm(`Quitter ${sp.label} ?`)){spaceId='D0PWE3';updSel();renderCards();showHome()}};
let pickedCat=null;
function step1(){const root=$("#step1");$("#step1").style.display='grid';$("#step2").style.display='none';root.innerHTML='';CATS.forEach(c=>{const el=document.createElement('div');el.className='opt';el.innerHTML=`<div class="emoji">${c.emoji}</div><div><b>${c.nom}</b></div>`;el.onclick=()=>{pickedCat=c.id;step2()};root.appendChild(el)})}
function step2(){const root=$("#step2");$("#step1").style.display='none';$("#step2").style.display='grid';root.innerHTML='';CHALLENGES.filter(x=>x.cat===pickedCat).forEach(x=>{const el=document.createElement('div');el.className='opt';el.innerHTML=`<div class="emoji">${x.emoji}</div><div><b>${x.titre}</b></div>`;el.onclick=()=>{alert("Habitude ajout√©e (d√©mo)");close(mHabit)};root.appendChild(el)})}
$("#closeHabit").onclick=()=>close(mHabit);
$("#prevDay").onclick=()=>{dayOff--;renderCards();renderDateBar()};$("#nextDay").onclick=()=>{dayOff++;renderCards();renderDateBar()};
function renderCalendarAndKeepMonth(){renderCalendar()}
let dayInit=false;function renderDateOnce(){if(!dayInit){dayOff=0;renderDateBar();dayInit=true}}
function updAll(){renderCards();renderCalendarAndKeepMonth();renderDateOnce();updSel()}
updAll();
document.addEventListener('keydown',e=>{if(e.key==='Escape'){['modalAdd','modalHabit','modalInvite','modalSpace','modalWizard'].forEach(id=>document.getElementById(id).classList.remove('on'))}})
function switchViews(btn,groupAttr,prefix){const key=btn.getAttribute(groupAttr);document.querySelectorAll(`.tabs [${groupAttr}]`).forEach(b=>b.classList.remove('active'));btn.classList.add('active');document.querySelectorAll(`#${prefix} .view`).forEach(v=>v.classList.remove('active'));const target=document.querySelector(`#${prefix} #${(groupAttr==='data-tab'?'tab-':'')}${key}`);if(target)target.classList.add('active');if(key==='history'){populateCalWho?.();renderCalendar?.()}if(key==='shistory'){populateSpaceWho?.();renderSpaceCalendar?.()}}
document.querySelectorAll('#detail .tabs [data-tab]').forEach(btn=>{btn.addEventListener('click',()=>switchViews(btn,'data-tab','detail').bind(null))});
document.querySelectorAll('#space .tabs [data-stab]').forEach(btn=>{btn.addEventListener('click',()=>switchViews(btn,'data-stab','space').bind(null))});
</script>
</body></html>